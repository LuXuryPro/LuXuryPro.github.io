<html>
<head>

<style>
img {
  width: 100%;
  height: 100%;
}
</style>

</head>
<body>

<script type="text/javascript">

function get_json(url,callback)
{
    var http_request = new XMLHttpRequest();

    // pobierz dane w formacie JSON z serwera
    http_request.onreadystatechange = handle_json;
    http_request.open("GET", url,true);
    http_request.send();

    function handle_json() {
        if (http_request.readyState == 4) {
                if (http_request.status == 200) {
                        var json_data = http_request.responseText; // pobranie tekstu
                        var the_object = JSON.parse(json_data);  // zamiana tekstu na obiekt JSON
                        callback(the_object);
                }
        }
    }
}
function add_row(data){
        var table = document.getElementById("table");
        var i = 0;
        while ( i < table.rows.length && data.viewers < parseInt(table.rows[i].cells[3].innerHTML) )
                i++;
        var tr;
        tr = table.insertRow(i);
        var preview = tr.insertCell(-1);
        var name = tr.insertCell(-1);
        var game = tr.insertCell(-1);
        var viewers = tr.insertCell(-1);
        var stat = tr.insertCell(-1);
        name.innerHTML = data.channel;
        viewers.innerHTML = data.viewers;
        preview.innerHTML = data.preview;
        stat.innerHTML  = data.status;
        game.innerHTML = data.game;
}

function parse_t(json){
    if (json.stream !== null) {
        var data = {};
        data.channel = json.stream.channel.name;
        data.game = json.stream.channel.game;
        data.online = true;
        data.viewers = json.stream.viewers;
        data.url = 'http://www.twitch.tv/' + data.channel;
        data.preview = '<a href='+data.url+ ' target="_blank"><img src='+json.stream.preview.medium+'></img></a>';
        data.status = json.stream.channel.status;
        add_row(data);
    }
}
function get_twitch(channel){
        script = document.createElement("script");
        script.type = "text/javascript";
        script.src = 'https://api.twitch.tv/kraken/streams/'+channel+'?callback=parse_t';
        document.head.appendChild(script);
        document.head.removeChild(script);
    }

function get_hitbox(channel){
        var url='http://api.hitbox.tv/media/live/'+channel;
		get_json(url,parse)
        function parse(json){
            if (json == null) {
                 return
            }
            if (json.media_type == 'live' && json.livestream[0].media_is_live == 1) {
                var data = {};
                data.online = true;
                data.channel = channel;
                data.viewers = json.livestream[0].media_views;
                data.game = json.livestream[0].category_name;
                data.url = 'http://www.hitbox.tv/'+ channel;
                data.preview = '<a href='+data.url+' target="_blank"><img src= http://edge.sf.hitbox.tv'+json.livestream[0].media_thumbnail+'></img></a>';
                data.status = json.livestream[0].media_status;
                add_row(data);
            }
        }
    }

function get_gaminglive(channel){
        var url='http://api.gaminglive.tv/channels/'+channel;
		get_json(url,parse)
        function parse(json){
            if (json == null) {
            }
            if (json.state) {
                var data = {};
                data.online = true;
                data.channel = channel;
                data.viewers = json.state.viewers;
                data.url = 'http://www.gaminglive.tv/channels/'+ channel;
                data.preview = '<a href='+data.url+ ' target="_blank" ><video loop type="video/mp4" src='+json.state.thumbnailUrl+'></wideo></a>';
                data.status = json.name;
                add_row(data);
            }
        }
    }
    var t = document.createElement('table');
    t.id = "table";
    t.border = 1;
    t.width = "100%";
    document.body.appendChild(t);
    window.setInterval(parse, 5*60*1000);
    parse();
    function parse(){
        t.innerHTML = "";
        get_gaminglive("Moskit");
        get_gaminglive("wonziu");
        get_hitbox("astrofaza");
        get_hitbox("GrabaGra");
        get_hitbox("jarock");
        get_hitbox("moskit");
        get_hitbox("Plaga");
        get_hitbox("rocklive");
        get_hitbox("vonzay");
        get_hitbox("Yuuhi");
        get_twitch("aster");
        get_twitch("bananagamingcsgo");
        get_twitch("byalli");
        get_twitch("esl_csgo");
        get_twitch("esl_csgo_pl");
        get_twitch("esltv_cs");
        get_twitch("esltvpl_cs");
        get_twitch("fechallenge");
        get_twitch("g5taz");
        get_twitch("gamingonlinux");
        get_twitch("inetkoxtv");
        get_twitch("innocenttt");
        get_twitch("isamuxlive");
        get_twitch("izakooo");
        get_twitch("janowicz");
        get_twitch("kittyplaysgames");
        get_twitch("leh_tv");
        get_twitch("mefju23");
        get_twitch("morgenowsky");
        get_twitch("moskitgp");
        get_twitch("nickbunyun");
        get_twitch("nvidia_pl");
        get_twitch("olofmeister");
        get_twitch("pago3");
        get_twitch("pashabiceps");
        get_twitch("phantoml0rd");
        get_twitch("powlie");
        get_twitch("soushibo");
        get_twitch("starladder_cs_pl");
        get_twitch("summit1g");
        get_twitch("szyzyg");
        get_twitch("viasatexplore");
        get_twitch("warowl");
        get_twitch("zaqwasss");
        get_twitch("GynvaelPL");
       	get_twitch("motar2k");
        get_hitbox("komputronikgaming");
    }
</script>
</body>
</html>
